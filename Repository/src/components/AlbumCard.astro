---
import type { CollectionEntry } from "astro:content";

type Props = {
  album: CollectionEntry<"albums">;
};

const { album } = Astro.props;

// Prepend base path to image URL if it starts with /
// BASE_URL is '/repo/' (with trailing slash), so we need to handle it correctly
const baseUrl = import.meta.env.BASE_URL.endsWith('/') 
  ? import.meta.env.BASE_URL.slice(0, -1) 
  : import.meta.env.BASE_URL;
const imageSrc = album.data.image.src.startsWith('/') 
  ? `${baseUrl}${album.data.image.src}`
  : album.data.image.src;
---

<a class="album-card" href={`${baseUrl}/${album.data.artist.id}/albums/${album.id}`}>
  <div>
    <img
      class="fade-in"
      loading="lazy"
      src={imageSrc}
      alt={album.data.image.alt}
    />
  </div>
  <h3>{album.data.name}</h3>
  <p>{new Date(album.data.publishDate).getFullYear()}</p>
</a>

<style>
  .album-card {
    display: flex;
    gap: 0.5rem;
    flex-direction: column;
    align-content: start;
    max-width: 300px;
  }
  div {
    aspect-ratio: 1;
    grid-area: img;
    background: var(--color-placeholder);
  }
  h3,
  p {
    margin: 0;
  }
  h3 {
    grid-area: title;
  }
  p {
    justify-self: end;
    grid-area: meta;
  }
</style>
