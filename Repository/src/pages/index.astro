---
import BaseLayout from "../layouts/BaseLayout.astro";
import ArtistGrid from "../components/ArtistGrid.astro";
import ArtistGridHeader from "../components/ArtistGridHeader.astro";
import Preloader from "../components/Preloader.astro";
import { fetchGithubRepos } from "../lib/github";

const githubUsername = "Karthikprasadm";
const githubToken = import.meta.env.GITHUB_TOKEN ?? process.env.GITHUB_TOKEN;
let githubProjects = [];

try {
  const repos = await fetchGithubRepos(githubUsername, githubToken);
  githubProjects = repos.map((repo) => ({
    id: repo.name,
    name: repo.name,
    fullName: repo.full_name,
    description: repo.description ?? "",
    language: repo.language ?? "Project",
    url: repo.html_url,
    image: `https://opengraph.githubassets.com/1/${repo.full_name}`,
    owner: repo.owner?.login ?? githubUsername,
    ownerAvatar: repo.owner?.avatar_url ?? "",
  }));
} catch (error) {
  githubProjects = [];
}

const artistsTotal = githubProjects.length;
const title = "Mnmnts | Repo";
---

<BaseLayout title={title}>
  <!-- 
    The <Preloader /> component is used to preload all images on the homepage using the images.loaded.js script. 
    If you don’t want to use the preloader (e.g., for faster page load times or if you don’t require preloading images), you can safely remove the <Preloader /> component from this layout.
  -->
  <Preloader />
  <ArtistGridHeader artistsTotal={artistsTotal} />
  <ArtistGrid projects={githubProjects} />
</BaseLayout>
<script src="../scripts/index.js"></script>
